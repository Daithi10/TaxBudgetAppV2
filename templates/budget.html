<!-- templates/budget.html -->
{% extends "base.html" %}

{% block title %}Monthly Budget Tracker{% endblock %}

{% block content %}
<div class="container">
    <h2>Monthly Budget Tracker</h2>

    {% if session.get('username') %}
        <p>Welcome, {{ session.get('username') }} | <a href="{{ url_for('logout') }}">Logout</a></p>
    {% endif %}

    <form method="POST" class="budget-form">
        <!-- Hidden username if logged in -->
        {% if session.get('username') %}
            <input type="hidden" name="username" value="{{ session.get('username') }}">
        {% else %}
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" placeholder="Enter your username" required>
        {% endif %}

        <label for="budget_name">Budget Name:</label>
        <input type="text" id="budget_name" name="budget_name" placeholder="e.g., July Budget" required>

        <label for="salary">Monthly Income (€):</label>
        <input type="number" id="salary" name="salary" step="0.01" placeholder="Enter your salary" required>

        <label for="rent">Rent (€):</label>
        <input type="number" id="rent" name="rent" step="0.01" required>

        <label for="groceries">Groceries (€):</label>
        <input type="number" id="groceries" name="groceries" step="0.01" required>

        <label for="transport">Transport (€):</label>
        <input type="number" id="transport" name="transport" step="0.01" required>

        <label for="utilities">Utilities (€):</label>
        <input type="number" id="utilities" name="utilities" step="0.01" required>

        <label for="other">Other Expenses (€):</label>
        <input type="number" id="other" name="other" step="0.01" required>

        <button type="submit" class="btn">Calculate</button>
    </form>

    {% if residual_income is not none %}
    <div class="result">
        <h3>Budget Summary{% if session.get('username') %} for {{ session.get('username') }}{% endif %}</h3>
        <p><strong>Residual Income:</strong> €{{ residual_income }}</p>

        <form method="POST" class="savings-form">
            <label for="savings">Percentage to save:</label>
            <input type="number" id="savings" name="savings" min="0" max="100" required>
            <input type="hidden" name="residual_income" value="{{ residual_income }}">
            <input type="hidden" name="action" value="save">
            <button type="submit" class="btn">Calculate Savings</button>
            <button type="submit" class="btn">Save Budget</button>
        </form>
    </div>
    {% endif %}

    {% if savings_amount is not none %}
    <div class="result">
        <h4>You chose to save {{ savings_percent }}% of your residual income.</h4>
        <p>That means €{{ savings_amount }} will go into savings monthly.</p>
    </div>
    {% endif %}

    {% if residual_income is not none and not session.get('username') %}
    <div class="signup-prompt">
        <h4>Want to track your savings progress?</h4>
        <p>Register to save your budget history and monitor your goals over time.</p>
        <a href="{{ url_for('register') }}" class="btn">Register now</a>
    </div>
    {% endif %}
</div>
{% endblock %}
