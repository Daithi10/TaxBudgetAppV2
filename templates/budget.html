{% extends "base.html" %}

{% block title %}Monthly Budget Tracker{% endblock %}

{% block content %}
<div class="container">
    <h2>Monthly Budget Tracker</h2>

    {% if session.get('username') %}
        <p>Welcome, {{ session.get('username') }} | <a href="{{ url_for('logout') }}">Logout</a></p>
    {% else %}
        <p>Please <a href="{{ url_for('login') }}">log in</a> to save budgets.</p>
    {% endif %}

    <!-- Calculate Residual Income -->
    <form method="POST">
        <input type="hidden" name="action" value="calculate">

        <label for="budget_name">Budget Name:</label>
        <input type="text" id="budget_name" name="budget_name" placeholder="e.g., July Budget" required>

        <label for="income">Monthly Income (€):</label>
        <input type="number" id="income" name="income" step="0.01" required>

        <label for="rent">Rent (€):</label>
        <input type="number" id="rent" name="rent" step="0.01" required>

        <label for="groceries">Groceries (€):</label>
        <input type="number" id="groceries" name="groceries" step="0.01" required>

        <label for="transport">Transport (€):</label>
        <input type="number" id="transport" name="transport" step="0.01" required>

        <label for="utilities">Utilities (€):</label>
        <input type="number" id="utilities" name="utilities" step="0.01" required>

        <label for="other">Other Expenses (€):</label>
        <input type="number" id="other" name="other" step="0.01" required>

        <button type="submit" class="btn">Calculate</button>
    </form>

    {% if residual_income is not none %}
    <div class="result">
        <h3>Budget Summary{% if session.get('username') %} for {{ session.get('username') }}{% endif %}</h3>
        <p><strong>Residual Income:</strong> €{{ residual_income }}</p>

        {% if session.get('username') %}
        <!-- Save Budget Form -->
        <form method="POST">
    <input type="hidden" name="action" value="calculate">
    <!-- Budget inputs -->
    <button type="submit">Calculate</button>
</form>
{% if residual_income is not none %}
<form method="POST">
    <input type="hidden" name="action" value="save">
    <input type="hidden" name="income" value="{{ request.form.get('income', '') }}">
    <input type="hidden" name="rent" value="{{ request.form.get('rent', '') }}">
    <input type="hidden" name="groceries" value="{{ request.form.get('groceries', '') }}">
    <input type="hidden" name="transport" value="{{ request.form.get('transport', '') }}">
    <input type="hidden" name="utilities" value="{{ request.form.get('utilities', '') }}">
    <input type="hidden" name="other" value="{{ request.form.get('other', '') }}">
    <label for="savings">Percentage to save:</label>
    <input type="number" id="savings" name="savings" min="0" max="100" required>
    <button type="submit">Save Budget</button>
</form>
{% endif %}

        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
